<scene_renderer_commands>
    <!--pre_render-->
	<!--generate the shadow maps -->
	<set_pool_renderable_objects_technique pool="shadow_map_pool_renderable_object_technique"/>
	<generate_shadow_maps/>
	
	<clear_scene color="true" depth="true" stencil="true"/>
	<begin_scene/>
	<enable_z_write/>
    <enable_z_test/>
	<disable_alpha_blend/>
	
	<!--generate the deferred textures-->
    <set_pool_renderable_objects_technique pool="generate_deferred_shading_pool_renderable_object_technique"/>
    <set_render_target name="deferred_multiple_render_target">
        <dynamic_texture stage_id="0" name="DiffuseMapTexture" texture_width_as_frame_buffer="true" format_type="A8R8G8B8"/>
        <dynamic_texture stage_id="1" name="LightMapTexture" texture_width_as_frame_buffer="true" format_type="A8R8G8B8"/>
        <dynamic_texture stage_id="2" name="NormalMapTexture" texture_width_as_frame_buffer="true" format_type="A8R8G8B8"/>
        <dynamic_texture stage_id="3" name="DepthMapTexture" texture_width_as_frame_buffer="true" format_type="R32F"/>
    </set_render_target>
    
    <clear_scene color="true" depth="true" stencil="true"/>
    <enable_z_write/>
    <enable_z_test/>
    <set_matrices/>
    <render_scene layer="solid" active="true"/>
    <render_debug_lights render="true"/>
    <unset_render_target render_target="deferred_multiple_render_target"/>
	
	<disable_z_write/>
    <disable_z_test/>
    
    <!--
    <enable_z_write/>
    <enable_z_test/>
    <render_scene layer="alpha_blend_objects" active="true"/>
    -->
    
    <set_pool_renderable_objects_technique pool="init_deferred_technique_pool_renderable_object_technique"/>
    <render_draw_quad active="true">
        <texture stage_id="0" name="LightMapTexture"/>
    </render_draw_quad>
    
    <!--<enable_alpha_blend srcblend="SrcAlpha" dstblend="InvSrcAlpha"/>-->
    <set_pool_renderable_objects_technique pool="render_deferred_technique_pool_renderable_object_technique"/>
    <render_deferred_shading>
        <texture stage_id="0" name="DiffuseMapTexture"/>
        <texture stage_id="1" name="LightMapTexture"/>
        <texture stage_id="2" name="NormalMapTexture"/>
        <texture stage_id="3" name="DepthMapTexture"/>
    </render_deferred_shading>
    
    <set_pool_renderable_objects_technique pool="lens_flare_pool_renderable_object_technique"/>
	<lens_of_flare>
		<texture stage_id="0" name="nova.png"/>
	</lens_of_flare>
    
    <!--<disable_alpha_blend/>-->
    <!--end pre_render-->
    
    <end_scene/>
    <present/>
</scene_renderer_commands>
